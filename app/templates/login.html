<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Login' if page == 'login' else 'Register' }} - HESA KNUST</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Login Page -->
    <div id="login-container" class="auth-container {{ 'active' if page == 'login' else '' }}">
        <h2>Login</h2>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form id="login-form" method="POST" action="{{ url_for('auth.login') }}">
            {{ form.hidden_tag() }}
            <div class="form-group">
                <label for="login-username">Username</label>
                {{ form.username(id="login-username", required=True) }}
                <div class="error-message" id="login-username-error">
                    {% if form.username.errors %}
                        {% for error in form.username.errors %}
                            {{ error }}
                        {% endfor %}
                    {% else %}
                        Please enter your username
                    {% endif %}
                </div>
            </div>
            <div class="form-group">
                <label for="login-password">Password</label>
                {{ form.password(id="login-password", required=True) }}
                <div class="error-message" id="login-password-error">
                    {% if form.password.errors %}
                        {% for error in form.password.errors %}
                            {{ error }}
                        {% endfor %}
                    {% else %}
                        Password is required
                    {% endif %}
                </div>
            </div>
            <div class="form-check mb-3">
                {{ form.remember(class="form-check-input") }}
                <label class="form-check-label" for="remember">Remember Me</label>
            </div>
            {{ form.submit(class="btn") }}
            <div class="auth-switch">
                Don't have an account? <a href="{{ url_for('auth.register') }}" id="switch-to-signup">Sign Up</a>
            </div>
        </form>
    </div>

    <!-- Signup Page -->
    <div id="signup-container" class="auth-container {{ 'active' if page == 'register' else '' }}">
        <h2>Create Account</h2>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form id="signup-form" method="POST" action="{{ url_for('auth.register') }}">
            {% if page == 'register' %}
                {{ form.hidden_tag() }}
                <div class="form-group">
                    <label for="signup-name">Username</label>
                    {{ form.username(id="signup-name", required=True) }}
                    <div class="error-message" id="signup-name-error">
                        {% if form.username.errors %}
                            {% for error in form.username.errors %}
                                {{ error }}
                            {% endfor %}
                        {% else %}
                            Please enter your username
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    {{ form.email(id="signup-email", required=True) }}
                    <div class="error-message" id="signup-email-error">
                        {% if form.email.errors %}
                            {% for error in form.email.errors %}
                                {{ error }}
                            {% endfor %}
                        {% else %}
                            Please enter a valid email
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    {{ form.password(id="signup-password", required=True) }}
                    <div class="error-message" id="signup-password-error">
                        {% if form.password.errors %}
                            {% for error in form.password.errors %}
                                {{ error }}
                            {% endfor %}
                        {% else %}
                            Password must be at least 8 characters
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirm Password</label>
                    {{ form.confirm_password(id="confirm-password", required=True) }}
                    <div class="error-message" id="confirm-password-error">
                        {% if form.confirm_password.errors %}
                            {% for error in form.confirm_password.errors %}
                                {{ error }}
                            {% endfor %}
                        {% else %}
                            Passwords do not match
                        {% endif %}
                    </div>
                </div>
                {{ form.submit(class="btn") }}
            {% endif %}
            <div class="auth-switch">
                Already have an account? <a href="{{ url_for('auth.login') }}" id="switch-to-login">Login</a>
            </div>
        </form>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Replace the entire script section with this: -->
<script>
    // Show error messages when form validation fails
    document.addEventListener('DOMContentLoaded', function() {
        // For login form
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const loginUsernameError = document.getElementById('login-username-error');
        const loginPasswordError = document.getElementById('login-password-error');
        
        if (loginUsername && loginUsernameError) {
            {% if form.username and form.username.errors %}
                loginUsername.classList.add('error');
                loginUsernameError.style.display = 'block';
            {% endif %}
        }
        
        if (loginPassword && loginPasswordError) {
            {% if form.password and form.password.errors %}
                loginPassword.classList.add('error');
                loginPasswordError.style.display = 'block';
            {% endif %}
        }
        
        // For signup form
        {% if page == 'register' %}
            const signupName = document.getElementById('signup-name');
            const signupEmail = document.getElementById('signup-email');
            const signupPassword = document.getElementById('signup-password');
            const confirmPassword = document.getElementById('confirm-password');
            
            if (signupName) {
                {% if form.username and form.username.errors %}
                    signupName.classList.add('error');
                    document.getElementById('signup-name-error').style.display = 'block';
                {% endif %}
            }
            
            if (signupEmail) {
                {% if form.email and form.email.errors %}
                    signupEmail.classList.add('error');
                    document.getElementById('signup-email-error').style.display = 'block';
                {% endif %}
            }
            
            if (signupPassword) {
                {% if form.password and form.password.errors %}
                    signupPassword.classList.add('error');
                    document.getElementById('signup-password-error').style.display = 'block';
                {% endif %}
            }
            
            if (confirmPassword) {
                {% if form.confirm_password and form.confirm_password.errors %}
                    confirmPassword.classList.add('error');
                    document.getElementById('confirm-password-error').style.display = 'block';
                {% endif %}
            }
        {% endif %}
    });
</script>
</body>
</html>